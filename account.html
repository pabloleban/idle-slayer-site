<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
      integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
    <title>Idle Slayer - Account Management</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HJ2E4V50Z5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-HJ2E4V50Z5');
    </script>

    <meta name="viewport" content="width=device-width, user-scalable=no">
    <link rel="icon" href="img/favicon.png">

    <style>
      body {
        background: radial-gradient(circle, rgba(255, 204, 1, 1) 0%, rgba(255, 161, 1, 1) 100%);
        color: black;
      }
      a { color: black; }
      h3 { margin-top: 50px; }
    </style>

    <!-- Firebase SDK (Compat versions) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  </head>

  <body>
    <div class="container mb-5">
      <div class="row justify-content-center">
        <div class="col-md-4 col-sm-8 col-10 m-5">
          <a href="./">
            <img class="w-100 logo" alt="Idle Slayer" title="Home" src="img/logo.png">
          </a>
        </div>
      </div>
      <h1 class="text-center title">Account Management</h1>

      <!-- Container for authentication (sign in) -->
      <div id="auth-container"></div>
      <!-- Container for account management options -->
      <div id="account-container"></div>
    </div>

    <script>
      // Replace these with your Firebase project configuration
      var firebaseConfig = {
        apiKey: "AIzaSyA619RzvC0SLFVOGxv3sVzfovgojTnVm5s",
        authDomain: "idleslayer.com",
        projectId: "idle-slayer-76996464",
        // Add other configuration fields as needed
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      const authContainer = document.getElementById('auth-container');
      const accountContainer = document.getElementById('account-container');

      // Render sign in form if user is not logged in
      function renderSignInForm() {
        authContainer.innerHTML = `
          <div class="row justify-content-center">
            <div class="col-md-6">
              <h3>Sign In</h3>
              <form id="signInForm">
                <div class="mb-3">
                  <label for="signInEmail" class="form-label">Email</label>
                  <input type="email" class="form-control" id="signInEmail" placeholder="Enter your email" required>
                </div>
                <div class="mb-3">
                  <label for="signInPassword" class="form-label">Password</label>
                  <input type="password" class="form-control" id="signInPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
              </form>
              <div id="signInMessage" class="mt-3"></div>
            </div>
          </div>
        `;

        document.getElementById('signInForm').addEventListener('submit', function(e) {
          e.preventDefault();
          const email = document.getElementById('signInEmail').value;
          const password = document.getElementById('signInPassword').value;
          firebase.auth().signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
              // Clear sign in form and render account management
              authContainer.innerHTML = '';
              renderAccountManagement(userCredential.user);
            })
            .catch((error) => {
              document.getElementById('signInMessage').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
            });
        });
      }

      // Render account management options for authenticated user
      function renderAccountManagement(user) {
        accountContainer.innerHTML = `
          <div class="row justify-content-center">
            <div class="col-md-6">
              <h3>Welcome, ${user.email}</h3>
              <button id="signOutBtn" class="btn btn-secondary mb-3">Sign Out</button>
              
              <h4>Update Email</h4>
              <form id="updateEmailForm">
                <div class="mb-3">
                  <label for="newEmail" class="form-label">New Email</label>
                  <input type="email" class="form-control" id="newEmail" placeholder="Enter new email" required>
                </div>
                <button type="submit" class="btn btn-primary">Update Email</button>
              </form>
              <div id="updateEmailMessage" class="mt-2"></div>
              
              <hr>
              
              <h4>Change Password</h4>
              <form id="changePasswordForm">
                <div class="mb-3">
                  <label for="newPassword" class="form-label">New Password</label>
                  <input type="password" class="form-control" id="newPassword" placeholder="Enter new password" required>
                </div>
                <button type="submit" class="btn btn-primary">Change Password</button>
              </form>
              <div id="changePasswordMessage" class="mt-2"></div>
              
              <hr>
              
              <h4>Delete Account</h4>
              <button id="deleteAccountBtn" class="btn btn-danger">Delete Account</button>
              <div id="deleteAccountMessage" class="mt-2"></div>
            </div>
          </div>
        `;

        // Sign out event
        document.getElementById('signOutBtn').addEventListener('click', function() {
          firebase.auth().signOut().then(() => {
            location.reload();
          });
        });

        // Update Email event
        document.getElementById('updateEmailForm').addEventListener('submit', function(e) {
          e.preventDefault();
          const newEmail = document.getElementById('newEmail').value;
          user.updateEmail(newEmail).then(() => {
            document.getElementById('updateEmailMessage').innerHTML = `<div class="alert alert-success">Email updated successfully.</div>`;
            // Optionally update the displayed email
            renderAccountManagement(user);
          }).catch((error) => {
            document.getElementById('updateEmailMessage').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
          });
        });

        // Change Password event
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
          e.preventDefault();
          const newPassword = document.getElementById('newPassword').value;
          user.updatePassword(newPassword).then(() => {
            document.getElementById('changePasswordMessage').innerHTML = `<div class="alert alert-success">Password changed successfully.</div>`;
          }).catch((error) => {
            document.getElementById('changePasswordMessage').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
          });
        });

        // Delete Account event
        document.getElementById('deleteAccountBtn').addEventListener('click', function() {
          if (confirm("Are you sure you want to delete your account? This action cannot be undone.")) {
            user.delete().then(() => {
              accountContainer.innerHTML = `<div class="alert alert-success">Your account has been deleted.</div>`;
              authContainer.innerHTML = '';
            }).catch((error) => {
              document.getElementById('deleteAccountMessage').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
            });
          }
        });
      }

      // Listen for authentication state changes
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          renderAccountManagement(user);
        } else {
          renderSignInForm();
        }
      });
    </script>
  </body>
</html>
